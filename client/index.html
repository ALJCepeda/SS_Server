<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Shazbot</title>

	<script src="knockout/dist/knockout.js" type="text/javascript"></script>
	<script src="underscore/underscore.js" type="text/javascript"></script>
	<script src="/socket.io/socket.io.js" type="text/javascript"></script>

	<link rel="stylesheet" href="css/flex.css">
</head>

<style type="text/css">
	#inputBox {
		width:80%;
	}

	.infopanel {
		width:100%;
		margin-top:20px;
	}

	.aside {
		flex:1 50%;
	}
</style>

<body style="min-height: 100%">
	<input id="inputBox" type="text"></input>
	<input id="submit" type="button" value="Submit"></input>

	<div class="infopanel">
		X: <label data-bind="text:accel_x"></label><br>
		Y: <label data-bind="text:accel_y"></label><br>
		Z: <label data-bind="text:accel_z"></label><br>
	</div>

	<div class="row-nw m-between">
		<div class="aside">
			<h2>From Device:</h2>
			<ul data-bind="foreach:fromDevice">
				<li><span data-bind="text: $data"></span></li>
			</ul>
		</div>

		<div class="aside">
			<h2>To Device:</h2>
			<ul data-bind="foreach:toDevice">
				<li><span data-bind="text: $data"></span></li>
			</ul>
		</div>
	</div>
</body>

<script type="text/javascript">
	var fromDevice = ko.observableArray([]);
	var toDevice = ko.observableArray([]);
	var accel_x = ko.observable(0);
	var accel_y = ko.observable(0);
	var accel_z = ko.observable(0);

	var inputBox = document.getElementById("inputBox");
	var socket = io();

	function submitMessage() {
		var message = inputBox.value;
		
		if(message !== "") {
			socket.emit("data", {
				message:message
			});

			inputBox.value = "";
		}
	}

	document.getElementById("submit").onclick = function() {
		submitMessage();
	};

	document.onkeyup = function() {
		if(window.event.keyCode === 13 && document.activeElement === inputBox) {
			submitMessage();
		}
	};

	ko.applyBindings({
		fromDevice:fromDevice,
		toDevice:toDevice,
		accel_x:accel_x,
		accel_y:accel_y,
		accel_z:accel_z,
	}, document.getElementById("bodyContainer"));

	socket.on("data", function(data) {
		fromDevice.push(data.message);
	});

	socket.on("acceleration", function(data) {
		if(typeof data.x !== "undefined") {
			accel_x(data.x);
		}

		if(typeof data.y !== "undefined") {
			accel_x(data.y);
		}

		if(typeof data.z !== "undefined") {
			accel_x(data.z);
		}		
	});

	socket.emit("startBrowser", { id:"test" });
</script>

</html>